# Internationalisation (i18n) — Foxeo Dash

> **Statut actuel :** P1 (français uniquement) — Structure prête pour P3 (multi-langue)

## Introduction

La plateforme Foxeo est structurée pour supporter plusieurs langues à l'avenir sans refactoring massif.

**P1 (actuel) :**
- Français uniquement (`fr`)
- Structure messages en place
- Helper `t()` et hook `useTranslations()` disponibles
- Middleware de détection locale opérationnel

**P3 (futur) :**
- Ajout de l'anglais (`en`)
- Possibilité d'ajouter d'autres langues
- Migration optionnelle vers `next-intl` si besoin de fonctionnalités avancées

## Structure actuelle

```
apps/
├── hub/messages/fr.json          # Messages Hub (actuellement vide)
├── client/messages/fr.json       # Messages Client (actuellement vide)

packages/ui/src/messages/
├── fr.json                        # Messages composants UI partagés
└── init.ts                        # Initialisation messages

packages/utils/src/
├── constants/i18n.ts              # SUPPORTED_LOCALES, DEFAULT_LOCALE, Locale type
└── i18n/translate.ts              # Helper t() et loadMessages()
```

## Ajouter une clé de traduction

### 1. Identifier l'emplacement

| Package | Fichier JSON | Usage |
|---------|-------------|-------|
| `@foxeo/ui` | `packages/ui/src/messages/fr.json` | Composants UI partagés |
| Hub app | `apps/hub/messages/fr.json` | Pages/modules spécifiques au Hub |
| Client app | `apps/client/messages/fr.json` | Pages/modules spécifiques au Client |

### 2. Structure JSON (nesting par composant)

```json
{
  "componentName": {
    "feature": {
      "key": "Valeur traduite"
    }
  }
}
```

### 3. Exemple

```json
{
  "clientList": {
    "header": {
      "title": "Liste des clients",
      "createButton": "Nouveau client"
    },
    "table": {
      "nameColumn": "Nom",
      "statusColumn": "Statut"
    },
    "empty": {
      "title": "Aucun client",
      "description": "Créez votre premier client"
    }
  }
}
```

### 4. Conventions de nommage

- **Clés JSON :** camelCase
- **Nesting :** Par composant/feature, puis par contexte
- **Pas de variables dynamiques en P1** (seront ajoutées en P3 si besoin)

## Utiliser les traductions

### Helper `t()` (Server Components ou logique serveur)

```typescript
import { t } from '@foxeo/utils'

const title = t('clientList.header.title') // "Liste des clients"
const missing = t('missing.key')            // "missing.key" (fallback gracieux)
```

### Hook `useTranslations()` (Client Components)

**Sans namespace :**
```typescript
'use client'

import { useTranslations } from '@foxeo/ui'

export function MyComponent() {
  const { t } = useTranslations()

  return <h1>{t('clientList.header.title')}</h1>
}
```

**Avec namespace (recommandé) :**
```typescript
'use client'

import { useTranslations } from '@foxeo/ui'

export function ClientList() {
  const { t } = useTranslations('clientList')

  return (
    <div>
      <h1>{t('header.title')}</h1>  {/* Résolu en 'clientList.header.title' */}
      <button>{t('header.createButton')}</button>
    </div>
  )
}
```

### Notation pointée

Le helper supporte la notation pointée pour naviguer dans la hiérarchie JSON :

```typescript
t('emptyState.search.title')  // Accède à messages.emptyState.search.title
```

## Tester une locale

### En développement (P1 — français uniquement)

Le cookie `NEXT_LOCALE` est automatiquement défini à `fr` par le middleware.

### Pour tester une future locale (P3)

1. **Via DevTools navigateur :**
   - Ouvrir la console → Application → Cookies
   - Modifier `NEXT_LOCALE` : `en` ou autre locale supportée
   - Rafraîchir la page

2. **Via code :**
   ```typescript
   'use client'

   import { useContext } from 'react'
   import { LocaleContext } from '@foxeo/ui'

   export function LanguageSwitcher() {
     const { locale, setLocale } = useContext(LocaleContext)

     return (
       <button onClick={() => setLocale('en')}>
         Switch to English
       </button>
     )
   }
   ```

## Ajouter une nouvelle langue (P3)

### Étapes

1. **Ajouter les fichiers de traduction**
   ```bash
   # Dupliquer fr.json vers en.json
   cp apps/hub/messages/fr.json apps/hub/messages/en.json
   cp apps/client/messages/fr.json apps/client/messages/en.json
   cp packages/ui/src/messages/fr.json packages/ui/src/messages/en.json
   ```

2. **Traduire les clés** dans les nouveaux fichiers `en.json`
   - Garder la structure JSON identique
   - Traduire uniquement les valeurs

3. **Mettre à jour les constantes**
   ```typescript
   // packages/utils/src/constants/i18n.ts
   export const SUPPORTED_LOCALES = ['fr', 'en'] as const
   export const DEFAULT_LOCALE = 'fr' as const
   ```

4. **Charger les messages anglais**
   ```typescript
   // packages/ui/src/messages/init.ts
   import { loadMessages } from '@foxeo/utils'
   import frMessages from './fr.json'
   import enMessages from './en.json'

   loadMessages('fr', frMessages)
   loadMessages('en', enMessages)
   ```

5. **Ajouter un language switcher** (optionnel)
   - Composant dans le header du dashboard
   - Dropdown avec les langues disponibles
   - Appelle `setLocale()` du LocaleContext

6. **Tester**
   - Changer le cookie `NEXT_LOCALE` → `en`
   - Vérifier que tous les textes changent
   - Tester le middleware (Accept-Language header)

### Migration vers next-intl (optionnel P3)

Si besoin de fonctionnalités avancées (pluralization, variables, date formatting) :

1. Installer `next-intl`
   ```bash
   npm install next-intl
   ```

2. Remplacer le helper custom par `useTranslations()` de next-intl
   - Structure JSON compatible
   - Migration progressive possible

3. Configurer `next.config.js` pour i18n routing si besoin

## Fallback gracieux

Si une clé est absente du fichier JSON, le helper `t()` retourne la clé elle-même :

```typescript
t('missing.key') // Retourne "missing.key" (pas d'erreur)
```

Cela permet de continuer à développer sans bloquer sur des traductions manquantes.

## Points d'attention

1. **Composants partagés (@foxeo/ui)** : Toujours utiliser `t()` pour les textes par défaut
2. **Props texte flexibles** : Les composants gardent leurs props `title`, `description` pour flexibilité
3. **Presets uniquement** : Seuls les presets/defaults utilisent `t()` (ex: `EMPTY_SEARCH`)
4. **Middleware** : Le cookie `NEXT_LOCALE` est défini automatiquement
5. **LocaleProvider** : Déjà intégré dans les layouts root (au-dessus de QueryProvider)

## Aide et support

- **Architecture :** `_bmad-output/planning-artifacts/architecture/04-implementation-patterns.md`
- **Story 1.10 :** `_bmad-output/implementation-artifacts/1-10-structure-multi-langue-p3-preparation-i18n.md`
- **CLAUDE.md :** Conventions de nommage, structure projet

---

*Documentation générée — Story 1.10*
